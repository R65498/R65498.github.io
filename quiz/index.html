<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.2">
    <title>君への挑戦状</title>
    <meta name="robots" content="noindex">
    <link rel="stylesheet" href="style.css?v=1.2">
</head>
<body>

    <div class="container">
        <h2 id="js-level-display"></h2>
        <p id="js-question" class="question-text"></p>
        <div id="js-items" class="btn-grid">
            </div>
    </div>

    <script>
        // --- 設定項目 ---
        // 2周目以降で、このレベルに到達すると最終問題へ進みます
        const finalLevelThreshold = 22;
        // 最終問題正解後に表示されるURL
        const finalQuizUrl = './final/index.html';

        // --- クイズデータ --- 
        const allQuizzes = {
            // 1周目のクイズ(写真無し)（簡単め 全体をふわっと）7
            round1: [
                { question: '<目標><br>レベルを自分の年齢にしましょう', answers: [ 'はい', 'いいえ',], correct: 'はい' },
                { question: '<練習問題><br>あなたの好きな色は？', answers: [ '青', '赤', '緑', '黄'], correct: '青' },
                { question: '僕たちが初めて二人で行ったところは？', answers: ['USJ', '大阪', '三宮', '四国'], correct: '大阪' },
                { question: '付き合い始めた記念日はいつ？', answers: ['10月5日', '10月6日', '10月7日', '10月8日'], correct: '10月6日' },
                { question: '<難問> <br> 僕の好きな食べ物は次のうちどれ？', answers: ['寿司', '焼肉', 'ラーメン', 'カレーライス'], correct: 'ラーメン' },
                { question: '初めて一緒に観た映画は？', answers: ['コナン', '花束みたいな恋をした', '教皇選挙', '変な家'], correct: 'コナン' },
                { question: 'ディズニーランドに遊びに行ったのはいつ？', answers: ['1年目', '2年目', '3年目', '4年目'], correct: '3年目' }
            ],
            // 2周目のクイズ(写真無し)（一年目　2022-2023/10/05）5
            round2: [
                { question: '<難問> <br> 生誕19歳を祝う写真で<br>ぶれて写っているのは？', answers: ['風船1', '風船9', '風船どちらも', '花びら'], correct: '風船9' },
                { question: '太陽の塔に行ったとき<br>京佳のスマホケースの色は?', answers: ['白', '透明', '青色', '赤色'], correct: '青色' },
                { question: '2023年の9/24日<br>彼氏にどのブランドの服を着てほしいと連絡している？', answers: ['オニツカタイガー', 'アディダス', '古着', 'NORTH FACE'], correct: 'アディダス' },
                { question: 'せきぐちの正式名称は？', answers: ['ジュナイパー', 'フクスロー', 'モクロー'], correct: 'モクロー' },
                { question: '一年記念日のときのアルバムの8/4のコメントは？', answers: ['グレートですよこいつは', '鬱イケア', '#スネの破壊者', 'せきぐちっ!!'], correct: 'グレートですよこいつは' }
            ],
            // 3周目のクイズ(写真有り)（二年目 2023/10/06-2024/10/05）7
            round3: [
                { question: '二年目のプレゼントで当てはまらないのは？', answers: ['香水', 'エプロン', 'リリス', 'イーブイパジャマ'], correct: 'リリス' },
                { question: '<難問> <br> ナゾと切符 阪神編のキーワードは？', answers: ['黒いひし形', '青いまる', '赤い血', '白い花'], correct: '黒いひし形' },
                { question: '湊山水族館で校長室ににいた生物は？', answers: ['カエル', 'イモリ', 'サンショウウオ', 'ヤモリ'], correct: 'カエル' },
                { question: '<難問> <br> 生野銀山の曲のなかでカバーされている言語はどれ？', answers: ['フランス語', '英語', 'タイ語', '韓国語'], correct: 'フランス語' },
                { question: '二年目のクリスマスで食べたものは？', answers: ['ピザ', '寿司', 'チーズフォンデュ', 'カレー'], correct: 'チーズフォンデュ' },
                { question: '温泉シャークにおいて、出演したサメの数は？', answers: ['5', '77', '350', '432'], correct: '432' },
                { question: 'クリスマスプレゼントで購入したマルジェラの香水の名前は？', answers: ['lazy sunday morning', 'on a date', 'when the rain stops', 'under the stars'], correct: 'when the rain stops' },
            ],
            // 4周目のクイズ(写真有り)（三年目 2024/10/05-2025/10/05）8
            round4: [
                { question: 'ラジオ会館で飲んだものとは？', answers: ['コーヒー', 'コーラ', '水', '抹茶'], correct: 'コーラ' },
                { question: '手料理で作ったパスタの名前はなんでしょう', answers: ['ナポリタン', '和風パスタ', 'ペスカトーレ', 'アラビアータ'], correct: 'アラビアータ' },
                { question: '好きなゲームプレゼンで僕が紹介したゲームは？', answers: ['モンハン', '妖怪ウォッチ', 'ポケモン', 'ペルソナ'], correct: '妖怪ウォッチ' },
                { question: '岡山旅行でいったモーニングはどこ？', answers: ['コメダ珈琲', '星乃珈琲店', 'ドトール', 'サンマルク'], correct: 'コメダ珈琲' },
                { question: '岡山旅行の一日目のお昼ご飯はなに？', answers: ['お好み焼き', 'うどん', 'ラーメン', 'カレー'], correct: 'お好み焼き' },
                { question: 'ディズニーランドのIt\'s a small worldでいた木のやつは？', answers: ['ヨンドゥ', 'ロケット', 'ガモーラ', 'グルート'], correct: 'グルート' },
                { question: '大阪万博で京佳が微妙な顔した飲食物は？', answers: ['ソーセージ', 'ミートパイ', 'サウジコーヒー', 'ラミントン'], correct: 'サウジコーヒー' },
                { question: '花火大会で選んだプリクラの機種は？', answers: ['Bloomit', 'ハルイロセカイ', 'VERUA', 'わたウサ'], correct: 'わたウサ' },
            ],
            // 5周目のクイズ(写真有り)（現在　これを救済措置とする）3
            round5: [
                { question: '僕のスマホの待ち受け画像はいつの写真？', answers: ['記念日の写真', '旅行の写真', '京佳の写真', '白一色'], correct: '白一色' },
                { question: '先週遊びにいったのはいつ？', answers: ['9/1', '9/2', '9/3', '9/4'], correct: '9/2' },
                { question: '今日はいてきた靴は?', answers: ['adidas', 'ドクターマーチン', 'VANS', 'TEVA'], correct: 'ドクターマーチン' },
            ],
        };

        // --- DOM要素の取得 ---
        const levelElement = document.getElementById('js-level-display');
        const questionElement = document.getElementById('js-question');
        const itemsElement = document.getElementById('js-items');
        
        // --- ゲーム状態変数 ---
        let level, round, quizIndex, currentQuizData;

        // --- ゲームの初期化・開始 ---
        const initializeApp = () => {
            // ローカルストレージから周回数とレベルを取得（なければ初期値1）(ページリロードしても続きから始まる)
            round = parseInt(localStorage.getItem('quizRound') || '1', 10);
            level = parseInt(localStorage.getItem('quizLevel') || '1', 10);
            
            // 現在の周回に応じたクイズデータをセット
            currentQuizData = allQuizzes['round' + round] || allQuizzes.round2;
            quizIndex = 0;

            setupQuiz();
        };

        // --- クイズの問題と選択肢を表示 ---
        const setupQuiz = () => {
            levelElement.textContent = `LEVEL: ${level} / 22`;
            questionElement.innerHTML = currentQuizData[quizIndex].question;
            
            while (itemsElement.firstChild) {
                itemsElement.removeChild(itemsElement.firstChild);
            }
            
            currentQuizData[quizIndex].answers.forEach(answer => {
                const button = document.createElement('button');
                button.textContent = answer;
                button.classList.add('btn');
                itemsElement.appendChild(button);
                button.addEventListener('click', e => judge(e.target));
            });
        };

        // --- 正誤判定 ---
        const judge = (selectedButton) => {
            if (selectedButton.textContent === currentQuizData[quizIndex].correct) {
                alert('正解！ レベルが 1 上がった！');
                level++;
                localStorage.setItem('quizLevel', level); // レベルを保存
                levelElement.textContent = `LEVAL: ${level}`;
            } else {
                alert('不正解！');
            }
            quizIndex++;
            goToNext();
        };

        // --- 次の問題に進む ---
        const goToNext = () => {
            // 2周目以降で、特定のレベルに達しているかチェック
            if (round > 1 && level >= finalLevelThreshold) {
                showFinalChallenge();
                return;
            }
            // 通常のクイズ進行
            if (quizIndex < currentQuizData.length) {
                setupQuiz();
            } else {
                showRoundResult();
            }
        };
        
        // --- 周回クリア時の結果表示 ---
        const showRoundResult = () => {
            questionElement.textContent = `現在のレベルは ${level} です！`;
            itemsElement.innerHTML = ''; // ボタンをクリア
            const restartButton = document.createElement('button');
            restartButton.textContent = '次のセクションに挑戦する';
            restartButton.classList.add('btn', 'restart-btn');
            itemsElement.appendChild(restartButton);

            restartButton.addEventListener('click', () => {
                const nextRound = round + 1;
                localStorage.setItem('quizRound', nextRound); // 次の周回数を保存
                location.reload(); // ページをリロードして次の周回へ
            });
        };

        // --- 最終問題の表示 ---
        const showFinalChallenge = () => {
            questionElement.textContent = '最終問題...';
            itemsElement.innerHTML = `<a href="${finalQuizUrl}" class="btn final-link">挑戦する</a>`;
        };

        // --- アプリケーションの実行 ---
        initializeApp();
    </script>
</body>
</html>